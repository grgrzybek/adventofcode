package grgr.adventofcode2017;

import java.io.BufferedReader;
import java.io.StringReader;
import java.io.StringWriter;
import java.util.ArrayList;
import java.util.List;

import org.junit.jupiter.api.Test;

public class Day19Test {

    String input1 = "     |          \n" +
            "     |  +--+    \n" +
            "     A  |  C    \n" +
            " F---|----E|--+ \n" +
            "     |  |  |  D \n" +
            "     +B-+  +--+ \n";
    String input2 = " |                                                                                                                                                                                                       \n" +
            " |                                   +---------------------------------------------------------------------------------------------------------------------------------------------------------------+   \n" +
            " |                                   |                                                                                                                                                               |   \n" +
            " |     +-------------------------------------------+                                                   +-------------+   +---------------+                     +-------------------------------------+   \n" +
            " |     |                             |             |                                                   |             |   |               |                     |                                         \n" +
            " |     +-----------------------------|---------+   |   +-+ +-------+                       +---+       |             |   |   +-----------|-----------------------------------------+   +-----------+     \n" +
            " |                                   |         |   |   | | |       |                       |   |       |             |   |   |           |                     |                   |   |           |     \n" +
            " |                                   |         +---|---|---|-------------------------------|---|-------|-------------|---|---------------|---------------------------------------------+           |     \n" +
            " |                                   |             |   | | |       |                       |   |       |             |   |   |           |                     |                   |               |     \n" +
            " |       +-----------------+         |         +---------|--------------------------B----------+       +-------------|---|---|-----------|---------------------|---------------+   | +---+     +-+ |     \n" +
            " |       |                 |         |         |   |   | | |       |                       |                         |   |   |           |                     |               |   | |   |     | | |     \n" +
            " |       |                 |         |         |   |   +-|---------|-------+               |           +---------------------------------------+               |               |   +-|---|-------+ |     \n" +
            " |       |                 |         |         |   |     | |       |       |               |           |             |   |   |           |     |               |               |     |   |     |   |     \n" +
            " |       |                 |         |         +---------|-|---------------|---------+     |     +-----|-------+     |   |   |           |     |               |               |     |   |     |   |     \n" +
            " |       |                 |         |             |     | |       |       |         |     |     |     |       |     |   |   |           |     |               |               |     |   |     |   |     \n" +
            " |       |                 +---------|-------------|-----|-|-------+       |         +-----|-----|-------------------+   | +-------------------+               |   +---------------------|-----|-------+ \n" +
            " |       |                           |             |     | |               |               |     |     |       |         | | |           |                     |   |           |     |   |     |   |   | \n" +
            " |       +---------------------------------------+ |   +-|-+               |               |     |     |     +-+ +-------|-|-|-+         |                     |   |           |     |   |     | +-+   | \n" +
            " |                                   |           | |   | |                 |               |     |     |     |   |       | | | |         |                     |   |           |     |   |     | |     | \n" +
            " |                                   |         +-|-----|-|-+               |     +---------|-----|-----------|---|---+ +-|-|-----+     +-|-+                   +---------+     +-------+ |     | |     | \n" +
            " |                                   |         | | |   | | |               |     |         |     |     |     |   |   | | | | | | |     | | |                       |     |           | | |     | |     | \n" +
            " |                                   |         | | |   | | |           +---|-----|---------|-----|-----|---------|---|-|-|-|---|-|-----|-|-|-----------------------------|-------+   | | | +---+ |     | \n" +
            " |                                   |         | | |   | | |           |   |     |         |     |     |     |   |   | | | | | | |     | | |                       |     |       |   | | | |     |     | \n" +
            " | +---------------------------------|---------|---|---|-|-------------|-------------------|-----------+     +---------|-|-+ | | +-+   | | +-------------+         |     |       |   | | | |     |     | \n" +
            " | |                                 |         | | |   | | |           |   |     |         |     |               |   | | |   | |   |   | |               |         |     |       |   | | | |     |     | \n" +
            " | | +-+ +-+                         |         | | |   | | |         +-----------|-----+   |     |   +-----------|---+ | |   | +---|-+ | |               |         |     |       |   | | | |     |     | \n" +
            " | | | | | |                         |         | | |   | | |         | |   |     |     |   |     |   |           |     | |   |     | | | |               |         |     |       |   | | | |     |     | \n" +
            " | | | | | +-------------------------|---------|-|-----|---|---------------|-----|---------|-----|---------------|-------|-------------|---+             |         |     |   +---|---|-|-|-------|-+   | \n" +
            " | | | | |                           |         | | |   | | |         | |   |     |     |   |     |   |           |     | |   |     | | | | |             |         |     |   |   |   | | | |     | |   | \n" +
            " | | | +---+         +-------------------------------+ +-|-+         | |   |     |     |   |     |   |           |     | |   +-----+ | | | |             |         |     |   |   |   | | | |     | |   | \n" +
            " | | |   | |         |               |         | | | |   |           | |   |     |     |   |     |   |           |     | |           | | | |             |         |     |   |   |   | | | |     | |   | \n" +
            " | | |   | |         |               |     +---|---|-----------------|-----------|-------------------|-----------------|-------------|-----------------------------|-----------------|---|-|-+   | |   | \n" +
            " | | |   | |         |               |     |   | | | |   |           | |   |     |     |   |     |   |           |     | |           | | | |             |         |     |   |   |   | | | | |   | |   | \n" +
            " | | |   | |       +-+ +-------------|---------|-|---|-------+       | |   |     |     |   |   +-----|-----------------------------------|-|-+   +-------|---------|-----|---|---------+ | +-----+ |   | \n" +
            " | | |   | |       |   |             |     |   | | | |   |   |       | |   |     |     |   |   | |   |           |     | |           | | | | |   |       |         |     |   |   |   |   |   |     |   | \n" +
            " | | |   | |       |   |             |     |   | | | |   |   |       | |   |     |     +---------|---|-----+     |     +-|-------------|-----+   |       |         |     |   |   |   |   |   |     |   | \n" +
            " | | |   | |       |   |             |     |   | | | |   |   |       | |   |     |         |   | |   |     |     |       |           | | | |     |       |         |     |   |   |   |   |   |     |   | \n" +
            " +---------------------------------------------|---|-|-+ |   |       | |   |     |     +-------------+     |     |       |     +-----|-|-|-------|-------|---------------|---|-------------+ |     |   | \n" +
            "   | |   | |       |   |             |     |   | | | | | |   |       | |   |     |     |   |   | |         |     |       |     |     | | | |     |       |         |     |   |   |   |   | | |     |   | \n" +
            "   | |   | | +---------------+     +-------|---|-|-+ | | |   |     +---|---|-----|-----|---|---|-------------------------------|---------|-|-----|-+     |         |     |   |   |   |   | | |     |   | \n" +
            "   | |   | | |     |   |     |     | |     |   | |   | | |   |     | | |   |     |     |   |   | |         |     |       |     |     | | | |     | |     |         |     |   |   |   |   | | |     |   | \n" +
            "   | |   | | |     |   |     |   +-|-------|-----|-----------|-------|-|---|-------------------|-|---------|-----|-------|-----------|-|-|-|-----------------------|-----|---+   |   |   | | | +-----+ | \n" +
            "   | |   | | |     |   |     |   | | |     |   | |   | | |   |     | | |   |     |     |   |   | |         |     |       |     |     | | | |     | |     |         |     |       |   |   | | | |   | | | \n" +
            "   | |   | | |     |   |     |   | | |     |   | |   | | |   |     | | |   |     |   +-+   |   +-|---+     |     | +-------+   |     | | | |     | |     |         |     |       |   |   | | | |   +---+ \n" +
            "   | |   | | |     |   |     |   | | |     |   | |   | | |   |     | | |   |     |   |     |     |   |     |     | |     | |   |     | | | |     | |     |         |     |       |   |   | | | |     |   \n" +
            "   | |   | +-|---------------------|-------|-+ | |   | | | +-------|-|-------------------------+ |   +-----|---------------------+ +---+ +-------|-----+ |   +-----|-------------|---------|-|---+ +---+ \n" +
            "   | |   |   |     |   |     |   | | |     | | | |   | | | | |     | | |   |     |   |     |   | |         |     | |     | |   | | | |     |     | |   | |   |     |     |       |   |   | | | | | | | | \n" +
            "   | |   |   |     |   |     |   | | |     | | | |   +-|-----|-------|-----+     |   |     |   | +---------------|-|-----------|---+ +-----|-----+ +---|-------------------------|---|---|-|-|-|---+ | | \n" +
            "   | |   |   |     |   |     |   | | |     | | | |     | | | |     | | |         |   |     |   |           |     | |     | |   | |         |           | |   |     |     |       |   |   | | | | |   | | \n" +
            "   | |   |   |     |   |     |   | | |     | | | |     | | | |     +-----------------|-----|---|-----------|-------|-----|---+ | +-+       |           | |   |     |     |       |   |   | | | | | +-|-+ \n" +
            "   | |   |   |     |   |     |   | | |     | | | |     | | | |       | |         |   |     |   |           |     | |     | | | |   |       |           | |   |     |     |       |   |   | | | | | | |   \n" +
            "   | |   |   |     |   |     |   | | |     | | +---+   | | | |     +---------------------------------------|-----|-|-------|---|-----------------------|-|---|-------------------|-----------|-+ | +---+ \n" +
            "   | |   |   |     |   |     |   | | |     | |   | |   | | | |     | | |         |   |     |   |           |     | |     | | | |   |       |           | |   |     |     |       |   |   | | |   |   | | \n" +
            "   | |   |   |     +-+ |     |   | | |     | |   | | +---|-|-+     | | |     +-------|---------|-----------------|-------------|-----------|-----------|-----------|-----|-----------|-+ | | |   |   | | \n" +
            "   | |   |   |       | |     |   | | |     | |   | | | | | |       | | |     |   |   |     |   |           |     | |     | | | |   |       |           | |   |     |     |       |   | | | | |   |   | | \n" +
            "   | |   |   | +-------|---------|---|-----|-----|-|-|---|-----------|-------|-------------+   |     +-----|-------|-+   | | | |   |       |           | |   |     |     |   +---|---|-|-|-|-|---------+ \n" +
            "   | |   |   | |     | |     |   | | |     | |   | | | | | |       | | |     |   |   |         |     |     |     | | |   | | | |   |       |           | |   |     |     |   |   |   | | | | |   |   |   \n" +
            "   | |   |   | |     | |     |   +---------|-|-----|---------------|-|-------|---|-------------------------|-----|-|-|---|---|-------------|-------------|-----+   |     |   |   |   | | | | |   |   |   \n" +
            "   | |   |   | |     | |     |     | |     | |   | | | | | |       | | |     |   |   |         |     |     |     | | |   | | | |   |       |           | |   | |   |     |   |   |   | | | | |   |   |   \n" +
            "   | |   |   | +-------------|-----|-|-----+ |   | | | | | |       | | |     |   |   |         |     |     |     | | +-----|-|-|---+       |           | |   | |   |     +---|---|---|-----+ | +-+   |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |         |     |     |     | |     | | | |           |           | |   | |   |         |   |   | | |   | |     |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |         |     |     |     | | +-------|-|-----------|-------------|---|-|-----------------------|---+ | |     |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |         |     |     |     | | |   | | | |           |           | |   | |   |         |   |   | | | | | |     |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |     +---|-----|-----|-----|-|-----|---|-------------|-----------|-|---|-|-------------|-+ |   | | | | | |     |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |   |     |   |     |     |     | | |   | | | |           |           | |   | |   |         | | |   | | | | | |     |   \n" +
            "   | |   |   | +-----|-------------------------------|---|-|-----------------|---|---|---------|-----|-----|-----|-|-|-----|-|-|-------------+         | |   | |   |       +-|-|-|---|---|-|-------+ |   \n" +
            "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   |   |     |   |     |     |     | | |   | | | |           | |         | |   | |   |       | | | |   | | | | | |   | |   \n" +
            "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   | +-|---------------|-----|---------|-----|-|-|-------------|---------|U|---------------+ | | | |   | | | | | |   | |   \n" +
            "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   | | |     |   |     |     |     | | |   | | | |           | |         | |   | |   |     | | | | |   | | | | | |   | |   \n" +
            "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   | +-+     |   |     |     |     | | |   +-|---|-------------|-+       | | +---|---------|-|-----|-+ | | | | | |   | |   \n" +
            "   | |   |   | |     | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |     |     | | |     | | |           | | |       | | | | |   |     | | | | | | | | | | | |   | |   \n" +
            "   | |   |   | +-----|-------|-----|-------------|---|---|-|-----------|-----------------------|-----|---------------------|-|-------------|-----------|-|-+ | |   |     | | | | | | | | | +-----+ | |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |     |     | | |     | | |           | | |       | |   | |   |     | | | | | | | | |   | | | | |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |   +-|-----|---------|-|---------------|-|---------------|---|-----+ | | | | | | | |   | | | | |   \n" +
            "   | |   |   |       | |     |     | |       |   | | | | | |       | | |     |   |         |   |     |   | |     | | |     | | |           | | |       | |   | |   |       | | | | | | | |   | | | | |   \n" +
            "   | | +---------+   | |     |     | | +-----|-------+ | | |       | +-----------------------------------|-|---------------+ | |       +---|-|-+     +-+ |   | |   +-------|-|-|-|---|-|-|-+ | | | | |   \n" +
            "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | |       |   |   | |           | | | | | | | | | | | | | |   \n" +
            "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | +-----+   |   | |     +---+ | | | | | | | | | | | | | |   \n" +
            "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | |         |   | |     |   | | | | | | | | | | | | | | |   \n" +
            "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | |         |   | |     |   | | | | | | | | | | | | | | |   \n" +
            "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         |   |     |   | |     | | |       | |       |   | | |         |   | |     |   | | | | | | | | | | | | | | |   \n" +
            "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |         +-------+ |   | |     | | |     +-|-|-------|-----|-|---------|-----------|-+ | | | | | | | | | | | | | | |   \n" +
            "   | | | |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |             |   | |   | |     | | |     | | |       |   | | |         |   | |     | | | | | | | | | | | | | | | | |   \n" +
            "   | | +-----|---|---|-|-----|-----|-----------------------------------|-----|-----------------|---------|-------|---------|-----+   +-------+ |         |   | |     | | | | | | | | | | | | | | | | |   \n" +
            "   | |   |   |   |   | |     |     | | |     |   | |   | | |       |   |     |   |             |   | |   | |     | | |     | | | |   | |   |   |         |   | |     | | | | | | | | | | | | | | | | |   \n" +
            "   | |   |   |   |   | +-------------|-|-----|-----|---|-|-|---+   |   |   +-|-----------------------|---|-|---------|-----|---|-|---|---------|-------------|---------|-+ | | +-----|-----|---|---|---+ \n" +
            "   | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | | |   | |   |   |         |   | |     | |   | |   | | | | | | | | | | | | \n" +
            " +-|-----|-------|---------------------|-----|---|-|---|-------|-----------|-|---------------------|-|-----|-----|-|-|-----|-|-|-----|-----|---|-------+ |   | +-----|-|-----|---|---|---|-|---|---+ | | \n" +
            " | | |   |   |   |   |       |     | O |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | | |   | |   |   |       | |   |       | |   | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | | +---|-----|-S |       | |   |       | +-+ | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             |   | |   | |     | | |     | | |     | |   |   |       | |   |       |   | | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |             +---|-|---|-|---------------|-|-|-------|---+ +-|-------|-----|-------|---+ | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |     |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | |     | |       | |   |       |     | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |   +-------|---|---|-------|-------|-----------------------|-|-------------------------|---------+   | |       | |   |       | +-+ | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |   | |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |   | |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |   | |   | |   | | |   |   |   |   | |   |                 | |   | |     | | |     | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |   | +-----|-------|-------|-----+ | |   |               +-|-|-----|-----|---|---+ | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
            " | | |   |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |     | | |   | | | |     | | |   | |       | |   |       | | | | |   | | | | | | | | |   | | \n" +
            " | | | +-|---|---|-----------|-------|-----|-----|-|---------------|-----|-|-|-------------------|-|-|---------+ | | |   | | | |     | | |   | +-------------|-+     | | | | |   | +---+ | | | | |   | | \n" +
            " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | | |     | | |   |         | |   | |     | | | | |   |   |   | | | | |   | | \n" +
            " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | | |     | | |   |         | |   | |     +---|---|-+ |   |   | | | | |   | | \n" +
            " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | | |     | | |   |         | |   | |       | | | | | |   |   | | | | |   | | \n" +
            " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | | +-----------|-+ |         | |   | |     +---|---+ | |   |   | | | | |   | | \n" +
            " | | | | |   |   |   |       |     | | |   |     | |   | | |   |   |   | | | |   |               | | |   | |   | | | |   | |   |     | | | | |         | |   | |     | | | |   | |   |   | | | | |   | | \n" +
            " | | | | |   |   | +-|---------------|-|-----------|-----|-----|---|-----|-------|-------------+ | +-------|-+ | | | |   | |   |     | | | | | +---------|---|-----------|-----|---------|---|-------|-+ \n" +
            " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | | | |       | |   | |     | | | |   | |   |   | | | | |   |   \n" +
            " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | | | |       | |   | |     | | | |   | |   |   | | | | |   |   \n" +
            " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | | | |       | |   | |     | | | |   | |   |   | | | | |   |   \n" +
            " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | | +-|-|-+     | |   | |     | | | |   | |   |   | | | | |   |   \n" +
            " | | | | |   |   | | |       |     | | |   |     | |   | | |   |   |   | | | |   |             | |   |   | | | | | | |   | |   |     | | |   | | |     | |   | |     | | | |   | |   |   | | | | |   |   \n" +
            " | | | | |   |   +-|-|-------|-----|---|---------|-|-----------+   |   | | | |   |             | |   +---|---|-|-|-|-------|---------|---|---|-+ +-+   | +---|-------+ | | |   | |   |   | | | | |   |   \n" +
            " | | | | |   |     | |       |     | | |   |     | |   | | |       |   | | | |   |             | |       | | | | | | |   | |   |     | | |   |     |   |     | |       | | |   | |   |   | | | | |   |   \n" +
            " | | | | |   |     | | +-------------------|-------|-------|-----------|---|-|-----------------|-----------|-------|-----|-+   +-------|-|---|-------------------------|---|-------------|-|---------|-+ \n" +
            " | | | | |   |     | | |     |     | | |   |     | |   | | |       |   | | | |   |             | |       | | | | | | |   |           | | |   |     |   |     | |       | | |   | |   |   | | | | |   | | \n" +
            " | | | | | +---------------------------|---|-----|-----------------|---|-|-|-|---|-------------|-|---------|-+ | | | |   |           | | | +-|-----|-----------|-------|---|-----|---|-+ | | | | |   | | \n" +
            " | | | | | | |     | | |     |     | | |   |     | |   | | |       |   | | | |   |             | |       | |   | | | |   |           | | | | |     |   |     | |       | | |   | |   | | | | | | |   | | \n" +
            " | | +---|---------------------------|-------------|-------------------|-|-|-|---------+ +-----|-----------|-----|-|-|---|-------------|-|-------+ |   |     | |       | | |   | +-----------+ | |   | | \n" +
            " | |   | | | |     | | |     |     | | |   |     | |   | | |       |   | | | |   |     | |     | |       | |   | | | |   |           | | | | |   | |   |     | |       | | |   |     | | | |   | |   | | \n" +
            " | |   | | | |     | | +-----|-----|---|---|---+ | |   | | |   +-------|-----|-----------|---------------|-------|---|-------------------|-+ |   | |   |     | |       | | | +-|-----|---|-|---|-|-+ | | \n" +
            " | |   | | | |     | |       |     | | |   |   | | |   | | |   |   |   | | | |   |     | |     | |       | |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | |   | | | | | \n" +
            " | |   | | +-+     | |       |     | | |   |   | | |   | | |   |   |   | | | |   |     | |     | |       +-------|-|-|---|-----------|---|---|---|-----|-----|-|---------|-----------|-|-|-|-+ | | | | | \n" +
            " | |   | |         | |       |     | | |   |   | | |   | | |   |   |   | | | |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | | | | | | | | \n" +
            " | | +---|---------|---+     |     | | |   |   | | |   | | |   | +-----|-|-+ |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | | | | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |   | |   |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     | |       | | | | |     | | | | | | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |   +---------|-----|-|-----------------|-------|-------------------|-|---|---|-|---|-------+       | | | | |     +-|---|-+ | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     |   |   |     | |     | |         |   | | | |   |           | | |   |   | |   |     |         | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     |   |   | +-----|-----------------|---|-|---|---|---------+ | | |   |   | |   |     |         | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     |   |   | |   | |     | |         |   | | | |   |         | | | |   |   | |   |     |         | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |     +-------+ |   | |     | |         |   | | | |   |       +-|-|-------+ +-------------|---+     | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |         |     |   | |     | |         |   | | | |   |       | | | | |     | | |   |     |   |     | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |         |     |   | |     | |         |   | | | |   |       | | | +-------+ | |   |     |   |     | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | | |         |     |   | |     | |         |   | | | |   |       | | |   |       | |   |     |   |     | C | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   | +---------------------|-|-----|-|-----------------|-----|-------------+ |       | |   |     |   |     | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   |   |         |     |   | |     | |         |   | | | |   |       | | | | |       | |   |     |   |     | | | | |       | | |   | | | | | \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   |   |         |     |   | |     | |         |   | | | |   |       | | | | |       | |   |     |   |     | | | | |       | | | +-|-----|-+ \n" +
            " | | | | |         | | |     |     | | |   |   | | |   | | |   |   |         |     |   | |     | |         |   | | | |   |       | | | | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
            " | | | | |         | | |     |     | | |   |   | +-----|-+ |   +-------------|-----------|-----------------+   | +-|-|---|-----------+ | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
            " | | | | |         | | |     |     | | |   |   |   |   |   |       |         |     |   | |     | |             |   | |   |       | |   | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
            " | | | | |         | | |     |     | | |   |   |   +---|---|-------|---------------|---+ |     | |             |   | |   |       | |   | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
            " | | | | |         | | |     |     | | |   |   |       |   |       |         |     |     |     | |             |   | |   |       | |   | |       | |   |     |   |     | | | | |       | | | | | | | |   \n" +
            " | | | | |         | | |     |     +-|-|---|---|-------|---|-------|-----+   |     |     +---+ | |         +---|---------|---------------------+ | |   |     |   |     | | | | | +-------|-|---|-|-|-|-+ \n" +
            " | | | | |         | | |     |       | |   |   |       |   |       |     |   |     |         | | |         |   |   | |   |       | |   | |     | | |   |     |   |     | | | | | |     | | | | | | | | | \n" +
            " | | | | |         | | |     |       | |   |   |       |   |       |     |   |     |         | | |         |   |   | |   |       | |   | |     | | |   |     |   |     | | | | | |     | | | | | | | | | \n" +
            " | | | | |         | | |     |       | |   |   |       |   |       |     |   |     |         | | |         |   |   | |   |       | |   | |     | | |   |     |   |     | | | | | |     | | | | | | | | | \n" +
            " | +-+ | |         | | |     |       | |   | +-+       |   |       |     |   |     |         | | +---------|-------|-|-----------|-|-----------|---|---|-----|---|-----+ +---|---------|-------|-----|-+ \n" +
            " |     | |         | | |     |       | |   | |         |   |       |     |   |     |         | |           |   |   | |   |       | |   | |     | | |   |     |   |         | | | |     | | | | | | | |   \n" +
            " |   +-------------|-|-------|-------------|-|-+   +---|---|-------|-----|---------|---+     | |           |   |   | |   |       | |   | |     | | |   |     |   |         | | | |     | | | | | | | |   \n" +
            " |   | | |         | | |     |       | |   | | |   |   |   |       |     |   |     |   |     | |           |   |   | |   |       | |   | |     | | |   |     |   |         | | | |     | | | | | | | |   \n" +
            " |   | | |       +-|---|---------------|-------|-------|-----------------|---|-----+   |     | |     +---------|---------|-------------|-------|---------------+ |     +-+ | | | |     | | | | | | | |   \n" +
            " |   | | |       | | | |     |       | |   | | |   |   |   |       |     |   |         |     | |     |     |   |   | |   |       | |   | |     | | |   |     | | |     | | | | | |     | | | | | | | |   \n" +
            " |   +-|---------|---+ |     |       | |   | | |   |   |   |       |     |   |         |   +---------|---------------------------|-----|---------------|---------------------|-|-|---+ | | +-+ | | | |   \n" +
            " |     | |       | |   |     |       | |   | | |   |   |   |       |     |   |         |   | | |     |     |   |   | |   |       | |   | |     | | |   |     | | |     | | | | | |   | | |     | | | |   \n" +
            " |     | |       | |   |     |       | |   | | |   |   | +-|-------------|-----------------|-|-------------|-+ |   | |   |       | +-----|-------|-----|-----|-|-------|-----|-|-------+ |     | | | |   \n" +
            " |     | |       | |   |     |       | |   | | |   |   | | |       |     |   |         |   | | |     |     | | |   | |   |       |     | |     | | |   |     | | |     | | | | | |   |   |     | | | |   \n" +
            " |     | |       | |   |     |     +-|-----|-|-----|-------------------+ |   |         | +-+ | |     |     | | |   | |   |       +-----+ |     | | |   |     | | |     +---|---|-|---|-+ |     | | | |   \n" +
            " |     | |       | |   |     |     | | |   | | |   |   | | |       |   | |   |         | |   | |     |     | | |   | |   |               |     | | |   |     | | |       | | | | |   | | |     | | | |   \n" +
            " +-----------------|---+     +-----+ | |   | | |   +---|---|-----------|-|---------------|-----|-----|-------------|-|-------------------+     | | |   |     | | |       | | | +-|---|-+ | +-+ | | | |   \n" +
            "       | |       | |                 | |   | | |       | | |       |   | |   |         | |   | |     |     | | |   | |   |                     | | |   |     | | |       | | |   |   |   | | | | | | |   \n" +
            "       | |       | |                 | |   | | |       | | |       |   | |   |         | |   | |     |     | | |   | |   |                     | | |   |     | | |       | | |   |   +-------|-----|---+ \n" +
            "       | |       | |                 | |   | | |       | | |       |   | |   |         | |   | |     |     | | |   | |   |                     | | |   |     | | |       | | |   |       | | | | | | | | \n" +
            "     +-|-------------------------------|-------|---------|-------------|-|---|-----------+   | |     |     | | |   | +---------------------------|---------------|-------|-|---------+ +---|---|-|-|-|-+ \n" +
            "     | | |       | |                 | |   | | |       | | |       |   | |   |         |     | |     |     | | |   |     |                     | | |   |     | | |       | | |   |   | | | | | | | | |   \n" +
            "     | | |   +---|-----------------+ | |   | | |       | | |     +-|---|---------------|-----|-|-----|---------|---------|-+                   | | |   |     | | |       +---|---|---|---|-------------+ \n" +
            "     | | |   |   | |               | | |   | | |       | | |     | |   | |   |         |     | |     |     | | |   |     | |                   | | |   E     | | |         | |   |   | | | | | | | | | | \n" +
            "     | | |   |   | |   +-----+     | | |   | | +-------|-|-|-------------|---|---------|-------|-----|-----|-------|-----+ |                   | | |   |     | | |         | | +-|---|-|-|-|-+ | | | | | \n" +
            "     | | |   |   | |   |     |     | | |   | |         | | |     | |   | |   |         |     | |     |     | | |   |       |                   | | |   |     | | |         | | | |   | | | |   | | | | | \n" +
            "     | | |   | +-|-----|-----|-------|-|-----------------|-|-----------|-----+         | +---|-------|-----|-------|-----+ |                 +---|-------------|-------------|-------|-----------|---+ | \n" +
            "     | | |   | | | |   |     |     | | |   | |         | | |     | |   | |             | |   | |     |     | | |   |     | |                 | | | |   |     | | |         | | | |   | | | |   | | |   | \n" +
            "     | | |   | | | |   |     |     | | |   | |         | | |     | |   | |             | |   | |     |     | | |   |     | |                 | | | |   |     | | |         | | | |   | | | |   | | |   | \n" +
            "     | | |   | | | |   |     |     | | |   | |         | | |     | |   | |             | |   | |     |     | | |   |     | |                 | | | |   |     | | |         | | | |   | | | |   | | |   | \n" +
            "     | | |   +---|-+   |     |     | | |   | |         | | |     | |   +-|-------------|-|-----------+     | | |   |     +-------------------|-+ +---------------|---------|-|-|-|---------|-----+ |   | \n" +
            "     | | |     | |     |     |     | | |   | |         | | |     | |     |             | |   | |           | | |   |       |                 |     |   |     | | |         | | | |   | | | |   |   |   | \n" +
            "     | | |     | |     |     |     | | |   | |         +-|-|-----|---------------------+ |   | |           | | +---------------+             |     |   |     | | |         | | | |   | | | |   |   |   | \n" +
            "     | | |     | |     |     |     | | |   | |           | |     | |     |               |   | |           | |     |       |   |             |     |   |     | | |         | | | |   | | | |   |   |   | \n" +
            "     | | |     | |     |     |     | | |   | |           | |     | |     |               |   | |           | |     |       |   |             |     |   +-------|-|---------|-----|---|-|-|-|---+ +-|-+ | \n" +
            "     | | |     | |     |     |     | | |   | |           | |     | |     |               |   | |           | |     |       |   |             |     |         | | |         | | | |   | | | |     | | | | \n" +
            " +-------+     | |     |     |     | | +---|-|-------------|-----|-----------------------|---------------------+   |       |   |       +-----------|-------------|---------|-|-|-|-------|-----+ | | | | \n" +
            " |   | |       | |     |     |     | |     | |           | |     | |     |               |   | |           | | |   |       |   |       |     |     |         | | |         | | | |   | | | |   | | | | | \n" +
            " |   | | +-------|-----------+     | |     | |           | |     | |     |               |   | | +-----------|-|-----------|---|-------|-----------|---------|-|-|---------|-+ | |   +-|-|-|---|-|-+ +-+ \n" +
            " |   | | |     | |     |           | |     | |           | |     | |     |               |   | | |         | | |   |       |   |       |     |     |         | | |         |   | |     | | |   | |       \n" +
            " |   | | |     | |     |           | |     | |           +-------+ +---------------------|---|-|-|---------|------M------------+     +-|-----------------------|---------------|-|-----|-|-|--W--------+ \n" +
            " |   | | |     | |     |           | |     | |             |             |               |   | | |         | | |   |       |         | |     |     |         | | |         |   | |     | | |   | |     | \n" +
            " |   | +-----------------------------------+ |             |             |               |   | | |         | | +---|-------------------+     |     +-----------|-----------|-------------+ +---|-------+ \n" +
            " |   |   Q     | |     |           | |       |             |             |               |   | | |         | |     |       |         |       |               | | |         |   | |     |       | |       \n" +
            " |   |   |     | |     +-------------|-------|-------------|-------------+               |   | | |         | |     |       |     +---|-------|---------------|---|-------------|-|-------------------+   \n" +
            " |   |   |     | |                 | |       |             |                             |   | | |         | |     |       |     |   |       |               | | |         |   | |     |       | |   |   \n" +
            " |   +---+     | |                 | |       |             |                             |   | | |         | | +---|-----------------|-----------------------|---|---------|---|-+     |       | |   |   \n" +
            " |             | |                 | |       |             |                             |   | | |         | | |   |       |     |   |       |               | | |         |   |       |       | |   |   \n" +
            " |             | |                 +---------+             |                             |   | | |         | | +-----------|-----|---|-----+ +---------------|-------------+   |       | +---+ | |   |   \n" +
            " |             | |                   |                     |                             |   | | |         | |     |       |     |   |     |                 | | |             |       | |   | | |   |   \n" +
            " |             | +-------------------+                     |                           +-----|-|-----------|-|-------------|-----|---|-----+     +-----------|-|-|-----------------------|-----|-+ +-+   \n" +
            " |             |                                           |                           | |   | | |         | |     |       |     |   |           |           | | |             |       | |   | |   |     \n" +
            " |             |                                           |                           | | +-|---|---------+ |     |       | +-------|-----------+ +-----------------+         +-------|-|---+ +-+ |     \n" +
            " |             |                                           |                           | | | | | |           |     |       | |   |   |             |         | | |   |                 | |       | |     \n" +
            " |             | +------A----------------------------------|---------------------------------+ | |           +---------------|-------|---------------------+ | +-|---+                 +-|-----+ | |     \n" +
            " |             | |                                         |                           | | |   | |                 |       | |   |   |             |       | |   |                       |     | | |     \n" +
            " |             | |                                         |                           | | |   | |                 |       | +---+   +-------------+       +-+   +-----------+           |     +-+ |     \n" +
            " |             | |                                         |                           | | |   | |                 |       |                                                 |           |         |     \n" +
            " +-------------+ +-----------------------------------------+                           +-+ +---+ +-----------------+       +-------------------------------------------------+           +---------+     \n" +
            "                                                                                                                                                                                                         \n";

    @Test
    public void test1() throws Exception {
        String line = null;
        BufferedReader reader = new BufferedReader(new StringReader(input2));
        int width = 0;
        List<char[]> _map = new ArrayList<>();
        while ((line = reader.readLine()) != null) {
            char[] array = line.toCharArray();
            _map.add(array);
            if (width < array.length) {
                width = array.length;
            }
        }

        char[][] map = new char[_map.size()][];
        int xs = -1;
        int ys = -1;
        for (int i = 0; i < map.length; i++) {
            map[i] = new char[width];
            char[] cline = _map.get(i);
            for (int j = 0; j < cline.length; j++) {
                map[i][j] = cline[j];
                if (((i == 0 || i == map.length - 1) && map[i][j] == '|')
                        || ((j == 0 || j == width - 1) && map[i][j] == '-')) {
                    xs = i;
                    ys = j;
                }
            }
            for (int j = cline.length; j < map[i].length; j++) {
                map[i][j] = ' ';
            }
        }
//        map[xs][ys] = '*';
//        for (int i = 0; i < map.length; i++) {
//            System.out.println(new String(map[i]));
//        }
        StringWriter sw = new StringWriter();
        int dx = 0;
        int dy = 0;
        if (xs == 0) {
            dx = 1;
        } else if (xs == map.length - 1) {
            dx = -1;
        } else if (ys == 0) {
            dy = 1;
        } else if (ys == width - 1) {
            dy = -1;
        }
        int[] last = new int[] { 0, 0 };
        char clast = ' ';
        out:
        while (true) {
            switch (map[xs][ys]) {
                case '|':
                    if (clast != '-') {
                        xs += dx;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    } else {
                        ys += dy;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    }
                    break;
                case '-':
                    if (clast != '|') {
                        ys += dy;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    } else {
                        xs += dx;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    }
                    break;
                case '+':
                    if (xs < map.length - 1 && dx != -1 && map[xs + 1][ys] != ' ') {
                        // down
                        xs++;
                        dx = 1;
                        dy = 0;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    } else if (xs > 0 && dx != 1 && map[xs - 1][ys] != ' ') {
                        // up
                        xs--;
                        dx = -1;
                        dy = 0;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    } else if (ys < width - 1 && dy != -1 && map[xs][ys + 1] != ' ') {
                        // right
                        ys++;
                        dx = 0;
                        dy = 1;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    } else if (ys > 0 && dy != 1 && map[xs][ys - 1] != ' ') {
                        // left
                        ys--;
                        dx = 0;
                        dy = -1;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    } else {
                        break out;
                    }
                    break;
                case ' ':
                    break out;
                default:
                    sw.write(map[xs][ys]);
                    xs += last[0];
                    ys += last[1];
                    break;
            }
        }
        System.out.println(sw.toString());
    }

    @Test
    public void test2() throws Exception {
        String line = null;
        BufferedReader reader = new BufferedReader(new StringReader(input2));
        int width = 0;
        List<char[]> _map = new ArrayList<>();
        while ((line = reader.readLine()) != null) {
            char[] array = line.toCharArray();
            _map.add(array);
            if (width < array.length) {
                width = array.length;
            }
        }

        char[][] map = new char[_map.size()][];
        int xs = -1;
        int ys = -1;
        for (int i = 0; i < map.length; i++) {
            map[i] = new char[width];
            char[] cline = _map.get(i);
            for (int j = 0; j < cline.length; j++) {
                map[i][j] = cline[j];
                if (((i == 0 || i == map.length - 1) && map[i][j] == '|')
                        || ((j == 0 || j == width - 1) && map[i][j] == '-')) {
                    xs = i;
                    ys = j;
                }
            }
            for (int j = cline.length; j < map[i].length; j++) {
                map[i][j] = ' ';
            }
        }
//        map[xs][ys] = '*';
//        for (int i = 0; i < map.length; i++) {
//            System.out.println(new String(map[i]));
//        }
        StringWriter sw = new StringWriter();
        int dx = 0;
        int dy = 0;
        if (xs == 0) {
            dx = 1;
        } else if (xs == map.length - 1) {
            dx = -1;
        } else if (ys == 0) {
            dy = 1;
        } else if (ys == width - 1) {
            dy = -1;
        }
        int[] last = new int[] { 0, 0 };
        char clast = ' ';
        int steps = -1;
        out:
        while (true) {
            steps++;
            switch (map[xs][ys]) {
                case '|':
                    if (clast != '-') {
                        xs += dx;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    } else {
                        ys += dy;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    }
                    break;
                case '-':
                    if (clast != '|') {
                        ys += dy;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    } else {
                        xs += dx;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    }
                    break;
                case '+':
                    if (xs < map.length - 1 && dx != -1 && map[xs + 1][ys] != ' ') {
                        // down
                        xs++;
                        dx = 1;
                        dy = 0;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    } else if (xs > 0 && dx != 1 && map[xs - 1][ys] != ' ') {
                        // up
                        xs--;
                        dx = -1;
                        dy = 0;
                        last[0] = dx;
                        last[1] = 0;
                        clast = '|';
                    } else if (ys < width - 1 && dy != -1 && map[xs][ys + 1] != ' ') {
                        // right
                        ys++;
                        dx = 0;
                        dy = 1;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    } else if (ys > 0 && dy != 1 && map[xs][ys - 1] != ' ') {
                        // left
                        ys--;
                        dx = 0;
                        dy = -1;
                        last[0] = 0;
                        last[1] = dy;
                        clast = '-';
                    } else {
                        break out;
                    }
                    break;
                case ' ':
                    break out;
                default:
                    sw.write(map[xs][ys]);
                    xs += last[0];
                    ys += last[1];
                    break;
            }
        }
        System.out.println(sw.toString() + ": " + steps);
    }

}
